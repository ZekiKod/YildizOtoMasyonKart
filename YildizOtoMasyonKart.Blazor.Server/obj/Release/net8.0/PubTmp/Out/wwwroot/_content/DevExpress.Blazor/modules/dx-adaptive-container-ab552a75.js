import{_ as e}from"./tslib.es6-d65164b3.js";import{S as t}from"./single-slot-element-base-bbf951b4.js";import{T as s}from"./toolbar-css-classes-795f4ae0.js";import{C as i}from"./css-classes-1103f305.js";import{T as o,a}from"./events-5ceb0642.js";import{s as r}from"./lit-element-462e7ad3.js";import{n as l}from"./property-4ec0b52d.js";import{e as n}from"./custom-element-267f9a21.js";import"./data-qa-utils-8be7c726.js";import"./const-90026e45.js";import"./dx-ui-element-b777832b.js";import"./lit-element-base-b20b52b2.js";import"./dx-license-e00a5bc7.js";import"./logicaltreehelper-67db40f1.js";import"./layouthelper-67dd777a.js";import"./point-e4ec110e.js";import"./constants-7c047c0d.js";import"./custom-events-helper-e7f279d3.js";var d,p,u;!function(e){e.Default="dxbl-adaptive-group-state-default",e.Text="dxbl-adaptive-group-state-text",e.NoText="dxbl-adaptive-group-state-no-text",e.Collapsed="dxbl-adaptive-group-state-collapsed"}(d||(d={})),function(e){e.Default="dxbl-adaptive-item-state-default",e.NoText="dxbl-adaptive-item-state-no-text",e.Collapsed="dxbl-adaptive-item-state-collapsed"}(p||(p={})),function(e){e.Default="dxbl-adaptive-ellipsis-state-default",e.Hidden="dxbl-toolbar-hidden-item"}(u||(u={}));const c=Object.values(d).map((e=>e));var h;Object.values(p).map((e=>e)),Object.values(u).map((e=>e)),function(e){e.Default="dxbl-adaptive-state-default",e.FullSequential="dxbl-adaptive-state-full-seq",e.NoText="dxbl-adaptive-state-no-text",e.NoTextSequential="dxbl-adaptive-state-no-text-seq",e.Group="dxbl-adaptive-state-group-text",e.GroupNoText="dxbl-adaptive-state-grouping-no-text"}(h||(h={}));const m=Object.values(h).map((e=>e));class f{}f.Adaptive=i.Prefix+"-adaptive",f.AdaptiveContainer=f.Adaptive+"-container",f.AdaptiveContainerContent=f.AdaptiveContainer+"-content",f.AdaptiveGroup=f.Adaptive+"-group",f.AdaptiveItem=f.Adaptive+"-item",f.EllipsisGroup=f.Adaptive+"-ellipsis-group",f.EllipsisGroupText=f.EllipsisGroup+"-text",f.EllipsisGroupNoText=f.EllipsisGroup+"-no-text",f.ItemCollapsed=f.AdaptiveItem+"-collapsed",f.ItemNoText=f.AdaptiveItem+"-no-text",f.VirtualContainer=f.Adaptive+"-virtual-container",f.VirtualTestContainer=f.VirtualContainer+"-test";const v=[f.EllipsisGroupNoText,f.EllipsisGroupText,u.Default,u.Hidden];class b{renderContainerDefaultState(e){var t,i,o;for(const t of e.groups)this.resetGroupToDefault(t),this.resetItems(t.items),this.expandGroup(t);e.root.classList.remove(...m),null===(t=e.ellipsis)||void 0===t||t.classList.remove(...v),null===(i=e.ellipsis)||void 0===i||i.classList.add(u.Hidden),null===(o=e.separator)||void 0===o||o.classList.add(s.ToolbarHiddenItem)}renderContainerNoTextState(e,t){t.forEach((t=>{const s=e.root.querySelector(`#${t}`);s&&s.classList.add(p.NoText)}))}renderGroupState(e,t){const s=e.element;s&&(s.classList.add(t),e.items.forEach((e=>this.hideElement(e))),this.showEllipsis(e))}renderContainerCollapsedState(e,t){if(t.forEach((t=>{const s=e.root.querySelector(`#${t}`);s&&s.classList.add(p.Collapsed)})),t.size>0){e.groups.filter((e=>e.items.some((e=>t.has(e.id))))).forEach((e=>this.showEllipsis(e)))}}showGlobalEllipsis(e){var t,i,o;null===(t=e.ellipsis)||void 0===t||t.classList.remove(...v),null===(i=e.ellipsis)||void 0===i||i.classList.remove(u.Hidden),null===(o=e.separator)||void 0===o||o.classList.remove(s.ToolbarHiddenItem)}hideGlobalEllipsis(e){var t,i,o;null===(t=e.ellipsis)||void 0===t||t.classList.remove(...v),null===(i=e.ellipsis)||void 0===i||i.classList.add(u.Hidden),null===(o=e.separator)||void 0===o||o.classList.add(s.ToolbarHiddenItem)}collapseGroup(e){e.items.forEach((e=>this.hideElement(e))),this.showEllipsis(e)}expandGroup(e){e.items.forEach((e=>this.showElement(e))),this.hideEllipsis(e)}resetGroupToDefault(e){e.element.classList.remove(...c),e.element.classList.remove(...m),e.ellipsis.classList.remove(...v)}resetItems(e){e.forEach((e=>{e.classList.remove(f.ItemNoText,f.ItemCollapsed,p.NoText.toString(),p.Collapsed.toString(),"dxbl-toolbar-item-collapsed","dxbl-toolbar-hidden-item"),e.classList.add(p.Default)}))}showEllipsis(e){e.ellipsis.classList.remove(s.ToolbarHiddenItem),e.ellipsis.classList.add(u.Default)}hideEllipsis(e){e.ellipsis.classList.remove(u.Default),e.ellipsis.classList.add(s.ToolbarHiddenItem)}showElement(e){e.classList.remove(f.ItemCollapsed)}hideElement(e){e.classList.add(f.ItemCollapsed)}}class g{createDefaultState(e){return{layout:h.Default,width:e.content.offsetWidth,groups:e.groups.map((e=>({id:e.element.id,state:d.Default,order:e.order,items:e.items.map((t=>({id:t.id,state:p.Default,groupId:e.element.id}))),ellipsis:{id:e.ellipsis.id,state:u.Hidden}}))),ellipsis:{id:e.ellipsis.id,state:u.Hidden}}}createNoTextState(e,t,s=new Set,i=d.Default){return{layout:h.NoText,width:e.content.offsetWidth,groups:e.groups.map((e=>({id:e.element.id,order:e.order,state:s.has(e.element.id)?d.Text:d.Default,items:e.items.map((i=>{return{id:i.id,groupId:e.element.id,state:(o=i.id,a=e.element.id,s.has(a)?p.Collapsed:t.has(o)?p.NoText:p.Default)};var o,a})),ellipsis:{id:e.ellipsis.id,state:s.has(e.element.id)?u.Default:u.Hidden}}))),ellipsis:{id:e.ellipsis.id,state:(o=s,e.groups.filter((e=>o.has(e.element.id))).flatMap((e=>e.blocks)).some((e=>e.collapseInGlobalGroup))?u.Default:u.Hidden)}};var o}createCollapseState(e,t,s,i){function o(e){const i=e.blocks.filter((e=>!e.collapseInGlobalGroup)).map((e=>e.id)).some((e=>t.has(e))),o=s.has(e.element.id);return i||o}return{layout:h.NoTextSequential,width:e.content.offsetWidth,groups:e.groups.map((e=>({id:e.element.id,order:e.order,state:s.has(e.element.id)?d.Text:d.Default,items:e.items.map((o=>{return{id:o.id,groupId:e.element.id,state:(a=o.id,r=e.element.id,s.has(r)||t.has(a)?p.Collapsed:i)};var a,r})),ellipsis:{id:e.ellipsis.id,state:o(e)?u.Default:u.Hidden}}))),ellipsis:{id:e.ellipsis.id,state:e.groups.flatMap((e=>e.blocks)).filter((e=>t.has(e.id)||s.has(e.groupId))).some((e=>e.collapseInGlobalGroup))?u.Default:u.Hidden}}}createGroupNoTextState(e,t){return{layout:h.GroupNoText,width:e.content.offsetWidth,groups:e.groups.map((e=>({id:e.element.id,order:e.order,state:t.has(e.element.id)?d.NoText:d.Text,items:e.items.map((t=>({id:t.id,groupId:e.element.id,state:p.Collapsed}))),ellipsis:{id:e.ellipsis.id,state:u.Default}}))),ellipsis:{id:e.ellipsis.id,state:e.groups.flatMap((e=>e.blocks)).some((e=>e.collapseInGlobalGroup))?u.Default:u.Hidden}}}}class x{constructor(){this.renderer=new b,this.factory=new g}getStates(e,t,s){const i=[],o=this.getBlocks(e),a=[];if(s.toGroups&&a.push(...this.getGroupLimits(e)),i.push(...this.getDefaultState(e,a)),s.toIcons&&i.push(...this.getNoTextStates(e,o,a)),s.hideItems){const t=i.filter((e=>e.layout===h.NoText)).sort(((e,t)=>e.width-t.width)).map((e=>e.width))[0];i.push(...this.getCollapsedStates(e,o,a,s.toIcons?p.NoText:p.Default,t))}return s.toGroups&&i.push(...this.getGroupNoTextStates(e,i)),i}getBlocks(e){return e.groups.flatMap((e=>e.blocks.reverse())).sort(((e,t)=>t.adaptivePriority-e.adaptivePriority))}getNoTextStates(e,t,s){const i=[],o=new Set,a=new Set;this.renderer.hideGlobalEllipsis(e);for(const r of t){o.add(r.id),this.renderer.renderContainerNoTextState(e,o);const t=e.groups.find((e=>e.element.id===r.groupId)),l=s.find((e=>e.groupId===t.element.id));if(l&&!this.compareGroupWidth(t,l)){if(a.has(l.groupId))continue;this.renderer.renderGroupState(t,d.Text),a.add(l.groupId)}i.push(this.factory.createNoTextState(e,o,a))}return i}getGroupLimits(e){const t=[];this.renderer.renderContainerDefaultState(e);for(const s of e.groups)this.renderer.renderGroupState(s,d.Text),t.push({groupId:s.element.id,width:s.element.offsetWidth});return t}getCollapsedStates(e,t,s,i,o){const a=[],r=new Set,l=new Set;let n=!1;for(const p of t){if(r.add(p.id),p.collapseInGlobalGroup&&!n&&(this.renderer.showGlobalEllipsis(e),n=!0),this.renderer.renderContainerCollapsedState(e,r),e.content.offsetWidth>o)continue;const t=e.groups.find((e=>e.element.id===p.groupId)),u=s.find((e=>e.groupId===t.element.id));if(u&&!this.compareGroupWidth(t,u)){if(l.has(u.groupId))continue;this.renderer.renderGroupState(t,d.Text),l.add(u.groupId)}a.push(this.factory.createCollapseState(e,r,l,i))}return a}getGroupNoTextStates(e,t){const s=[],i=t.filter((e=>e.groups.every((e=>e.state===d.Text)))),o=new Set,a=new Set(i.flatMap((e=>e.groups)).sort(((e,t)=>e.order-t.order)).map((e=>e.id)));for(const t of a){const i=e.groups.find((e=>e.element.id===t));i.hasIcon&&(o.add(t),this.renderer.renderGroupState(i,d.NoText),s.push(this.factory.createGroupNoTextState(e,o)))}return s}compareGroupWidth(e,t){return e.element.offsetWidth>t.width}getDefaultState(e,t){this.renderer.renderContainerDefaultState(e);for(const s of e.groups){const e=t.find((e=>e.groupId===s.element.id));e&&!this.compareGroupWidth(s,e)&&this.renderer.renderGroupState(s,d.Text)}return[this.factory.createDefaultState(e)]}}const S=Object.values(d).map((e=>e)),I=Object.values(p).map((e=>e)),C=Object.values(u).map((e=>e));class T{constructor(){this.appliedState=null,this.states=[],this.currentCheckpoint=0,this.calculator=new x,this.containerItemsUpdate=null}async configure(e,t,s){const i=this.copyContainer(e),o=this.createAdaptiveContainer(i,t);0!==o.content.offsetWidth&&(this.states=this.calculator.getStates(o,t,s),o.root.remove(),await this.adjust(e,t))}async adjust(e,t){const s=this.createAdaptiveContainer(e,t),i=s.root.offsetWidth,o=this.states.map((e=>e.width)).sort(((e,t)=>t-e)).find((e=>e<i));if(this.appliedState&&this.currentCheckpoint&&this.currentCheckpoint===o)return;e.querySelector(`.${f.AdaptiveContainerContent}`);const a=this.states.filter((e=>e.width===o))[0];a&&(this.currentCheckpoint=o,await this.waitForAnimationFrame((()=>{if(this.applyNewState(s,a),this.containerItemsUpdate&&a.groups.length>0){const e=a.groups.map((e=>e.items)).reduce(((e,t)=>e.concat(t))).map((e=>({Id:e.id,TextHidden:e.state===p.NoText,IsVisible:e.state!==p.Collapsed})));this.containerItemsUpdate(e)}})))}applyNewState(e,t){for(const s of t.groups)this.applyGroupState(e,s);t.ellipsis&&this.applyEllipsisState(e,t.ellipsis),this.appliedState=t}waitForAnimationFrame(e){return new Promise((t=>{requestAnimationFrame((s=>{e(),t(s)}))}))}applyGroupState(e,t){const s=e.root.querySelector(`#${t.id}`);if(s){s.classList.remove(...S),s.classList.add(t.state),s.dispatchEvent(new o(t.state.toString()));for(const s of t.items)this.applyItemState(e,s);t.ellipsis&&this.applyEllipsisState(e,t.ellipsis)}}applyItemState(e,t){const s=e.root.querySelector(`#${t.id}`);s&&(s.classList.remove(...I),s.classList.add(t.state))}applyEllipsisState(e,t){const s=e.root.querySelector(`#${t.id}`);s&&(s.classList.remove(...C),s.classList.add(t.state))}copyContainer(e){const t=e.cloneNode(!0);t.classList.add(f.VirtualContainer),t.style.visibility="hidden",t.style.position="absolute";return e.parentElement.appendChild(t),t}createAdaptiveContainer(e,t){const i=e.querySelector(`.${f.AdaptiveContainerContent}`),o=i.querySelectorAll(`.${f.AdaptiveGroup}`);let a=0;return{root:e,content:i,groups:[...o].reverse().map((e=>{a++;const i=e.querySelectorAll(t),o=e;return{element:e,order:a,hasText:o.hasAttribute("has-adaptive-text"),hasIcon:o.hasAttribute("has-adaptive-icon"),items:[...i],blocks:[...i].map((t=>({id:t.id,groupOrder:a,groupId:e.id,collapsed:!1,noText:!1,adaptivePriority:parseInt(t.getAttribute("adaptive-priority")),collapseInGlobalGroup:t.hasAttribute("collapse-in-global-group")}))),ellipsis:e.querySelector(`.${s.ButtonEllipsis}`)}})),separator:e.querySelector(".dxbl-ribbon-general-separator"),ellipsis:e.querySelector(".dxbl-toolbar-btn-ellipsis-general")}}}class y{constructor(e){this.id=e}}class G extends CustomEvent{constructor(e){super(G.eventName,{detail:new y(e),bubbles:!0})}}G.eventName="dxbl-ribbon-item.resized";class w{constructor(e,t){this.id=e,this.adaptivePriority=t}}class E extends CustomEvent{constructor(e,t){super(E.eventName,{detail:new w(e,t),bubbles:!0,composed:!0})}}E.eventName="dxbl-ribbon-item.updated";let N=class extends t{constructor(){super(...arguments),this.containerResizeObserver=null,this.contentResizeObserver=null,this.isAdaptivityEnabled=!1,this.virtualContainer=new T,this.itemResizedHandler=this.itemResized.bind(this),this.adaptiveItemUpdatedHandler=this.adaptiveItemUpdated.bind(this),this.initialized=!1,this.collapseToIcons=!1,this.canHideItems=!1,this.collapseToGroups=!1,this.minRootItemCount=0,this.itemSelector=".dxbl-adaptive-item:not(.dxbl-toolbar-btn-ellipsis)"}get settings(){return{toIcons:this.collapseToIcons,toGroups:this.collapseToGroups,hideItems:this.canHideItems}}firstUpdated(){this.tryAdapt()}updated(e){super.updated(e),(e.has("collapseToIcons")||e.has("canHideItems")||e.has("collapseToGroups"))&&this.configure()}connectedCallback(){super.connectedCallback(),this.addEventListener(G.eventName,this.itemResizedHandler),this.addEventListener(E.eventName,this.adaptiveItemUpdatedHandler),this.virtualContainer.containerItemsUpdate=e=>{this.dispatchEvent(new a(Array.from(e)))}}disconnectedCallback(){var e;super.disconnectedCallback(),this.removeEventListener(G.eventName,this.itemResizedHandler),this.removeEventListener(E.eventName,this.adaptiveItemUpdatedHandler),null===(e=this.containerResizeObserver)||void 0===e||e.unobserve(this)}tryAdapt(){this.classList.contains(f.VirtualContainer)||(this.containerResizeObserver=new ResizeObserver((()=>new Promise((()=>this.adjust())))),this.containerResizeObserver.observe(this),this.contentResizeObserver=new ResizeObserver((()=>{0!==this.offsetWidth&&this.configure()})),this.contentResizeObserver.observe(this.querySelector(`.${f.AdaptiveContainerContent}`)),this.initialized=!0,this.configure())}async configure(){this.initialized&&await this.virtualContainer.configure(this,this.itemSelector,this.settings)}async adjust(){await this.virtualContainer.adjust(this,this.itemSelector)}itemResized(e){super.getUpdateComplete().then((()=>this.virtualContainer.configure(this,this.itemSelector,this.settings)))}adaptiveItemUpdated(e){}};N.shadowRootOptions={...r.shadowRootOptions,mode:"open"},e([l({attribute:"collapse-to-icons",type:Boolean})],N.prototype,"collapseToIcons",void 0),e([l({attribute:"can-hide-items",type:Boolean})],N.prototype,"canHideItems",void 0),e([l({attribute:"collapse-to-groups",type:Boolean})],N.prototype,"collapseToGroups",void 0),e([l({attribute:"min-root-item-count",type:Number})],N.prototype,"minRootItemCount",void 0),N=e([n("dxbl-adaptive-container")],N);const L=N;export{L as default};
