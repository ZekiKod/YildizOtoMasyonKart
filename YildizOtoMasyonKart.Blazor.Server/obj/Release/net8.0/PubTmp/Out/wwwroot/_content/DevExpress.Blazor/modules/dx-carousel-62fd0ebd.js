import{_ as e}from"./tslib.es6-d65164b3.js";import{S as t}from"./single-slot-element-base-bbf951b4.js";import{C as i}from"./custom-events-helper-e7f279d3.js";import{C as n}from"./events-a8fe5872.js";import{s}from"./enumConverter-6047c3ff.js";import{k as o}from"./key-a66127fc.js";import{P as r}from"./point-e4ec110e.js";import{n as a}from"./property-4ec0b52d.js";import{e as h}from"./custom-element-267f9a21.js";import"./data-qa-utils-8be7c726.js";import"./const-90026e45.js";import"./dx-ui-element-b777832b.js";import"./lit-element-base-b20b52b2.js";import"./dx-license-e00a5bc7.js";import"./lit-element-462e7ad3.js";import"./logicaltreehelper-67db40f1.js";import"./layouthelper-67dd777a.js";import"./constants-7c047c0d.js";import"./_commonjsHelpers-41cdd1e7.js";import"./string-2448bf95.js";import"./browser-3fc721b7.js";const l="dxbl-carousel";class c extends n{constructor(){super(c.eventName)}}c.eventName=l+".swipe-start";class d extends CustomEvent{constructor(e){super(d.eventName,{detail:new p(e),bubbles:!0,composed:!0,cancelable:!0})}}d.eventName=l+".swipe-end";class p{constructor(e){this.Direction=e}}class m extends CustomEvent{constructor(e){super(m.eventName,{detail:e,bubbles:!0,composed:!0,cancelable:!0})}}m.eventName=l+".mouse-scroll";class u extends CustomEvent{constructor(e){super(u.eventName,{detail:e,bubbles:!0,composed:!0,cancelable:!0})}}u.eventName=l+".shortcut",i.register(c.eventName,(e=>e.detail)),i.register(d.eventName,(e=>e.detail)),i.register(m.eventName,(e=>{const t=e.detail;return{DeltaX:t.deltaX,DeltaY:t.deltaY,DeltaZ:t.deltaZ,DeltaMode:t.deltaMode}})),i.register(u.eventName,(e=>{const t=e.detail;return{Key:t.key,Code:t.code,CtrlKey:t.ctrlKey,AltKey:t.altKey,ShiftKey:t.shiftKey,MetaKey:t.metaKey}}));const v="none";var w;!function(e){e[e.None=0]="None",e[e.Touch=1]="Touch",e[e.TouchAndPointer=2]="TouchAndPointer"}(w||(w={}));let b=class extends t{get content(){return this.querySelector(".dxbl-carousel-content")}constructor(){super(),this.width=0,this.swipingStart=new r(0,0),this.isSwiping=!1,this.lastWheelExecutionTime=null,this.gestureCover=null,this.keyDownHandler=this.onKeyDown.bind(this),this.mouseWheelHandler=this.onMouseWheel.bind(this),this.touchMoveHandler=this.onTouchMove.bind(this),this.pointerDownHandler=this.onPointerDown.bind(this),this.stopSwipingHandler=this.stopSwiping.bind(this),this.cancelSwipingHandler=this.cancelSwiping.bind(this),this.performSwipingHandler=this.performSwiping.bind(this),this.allowMouseWheel=!1,this.animation="",this.activeIndex=-1,this.displayIndex=-1,this.loop=!1,this.swipeMode=w.Touch,this.resizeObserver=new ResizeObserver((e=>{for(const t of e)this.width=t.contentRect.width}))}moveNext(e=this.animation){var t;if(this.setTransition(e),this.activeIndex===this.displayIndex){const e=this.getTransform(this.activeIndex);this.content&&this.content.style.transform!==e&&this.applyTransform(e)}else{const e=this.getTransform(this.displayIndex);if(this.content&&this.content.style.transform!==e){const i=this.activeIndex;this._moveFast=()=>{var e,t;null===(e=this.content)||void 0===e||e.removeEventListener("transitionend",this._moveFast),this.setTransition(v),this.applyTransform(this.getTransform(i)),null===(t=this.content)||void 0===t||t.getBoundingClientRect(),this._moveFast=void 0},null===(t=this.content)||void 0===t||t.addEventListener("transitionend",this._moveFast),this.applyTransform(e)}}}createRenderRoot(){return this}updated(e){super.updated(e),e.has("loop")?this.moveNext(v):e.has("activeIndex")&&(this._moveFast&&this._moveFast(),this.moveNext())}connectedOrContentChanged(){super.connectedOrContentChanged(),this.applyTransform(this.getTransform(this.activeIndex))}connectedCallback(){this.addEventListener("pointerdown",this.pointerDownHandler),this.addEventListener("wheel",this.mouseWheelHandler),this.addEventListener("keydown",this.keyDownHandler),super.connectedCallback(),this.resizeObserver.observe(this)}disconnectedCallback(){var e;this.removeEventListener("pointerdown",this.pointerDownHandler),this.removeEventListener("wheel",this.mouseWheelHandler),this.removeEventListener("keydown",this.keyDownHandler),super.disconnectedCallback(),null===(e=this.resizeObserver)||void 0===e||e.unobserve(this)}onKeyDown(e){if(e.target!==this)return;const t=o.KeyUtils.getEventKeyCode(e);t!==o.KeyCode.Left&&t!==o.KeyCode.Right&&t!==o.KeyCode.Space||(e.preventDefault(),this.dispatchEvent(new u(e)))}onMouseWheel(e){if(this.allowMouseWheel){e.preventDefault();const t=new Date;if(this.lastWheelExecutionTime&&t.getTime()-this.lastWheelExecutionTime.getTime()<100)return;this.lastWheelExecutionTime=t,this.dispatchEvent(new m(e))}}onPointerDown(e){if(0!==e.button)return;if(this.swipeMode===w.None)return;const t="touch"===e.pointerType;if(this.swipeMode===w.Touch&&!t)return;const i=e.target;if(i&&(this.content.contains(i)||i.classList.contains("dxbl-carousel-substrate-button"))){if(i instanceof HTMLElement&&(i.isContentEditable||i.hasAttribute("contenteditable"))||i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement){if(!t)return;if(document.activeElement===i)return}this.onStartSwiping(e.clientX,e.clientY)}}onStartSwiping(e,t){this.swipingStart=new r(e,t),document.addEventListener("pointermove",this.performSwipingHandler),document.addEventListener("pointerup",this.stopSwipingHandler),document.addEventListener("pointercancel",this.cancelSwipingHandler),document.addEventListener("touchmove",this.touchMoveHandler,{passive:!1})}stopSwiping(e){this.onStopSwiping(e.clientX)}cancelSwiping(e){this.onStopSwiping(this.swipingStart.x)}onStopSwiping(e){var t;if(this.isSwiping){const i=e-this.swipingStart.x,n=this.width/3,s=Math.abs(i)<n?0:Math.sign(i);this.setTransition(this.animation),(0===s||1===s&&!this.loop&&0===this.activeIndex||-1===s&&!this.loop&&this.activeIndex===this.content.childElementCount-1)&&this.applyTransform(this.getTransform(this.activeIndex)),null===(t=this.gestureCover)||void 0===t||t.remove(),this.isSwiping=!1,this.dispatchEvent(new d(s))}this.swipingStart=new r(0,0),document.removeEventListener("pointermove",this.performSwipingHandler),document.removeEventListener("pointerup",this.stopSwipingHandler),document.removeEventListener("pointercancel",this.cancelSwipingHandler),document.removeEventListener("touchmove",this.touchMoveHandler)}onTouchMove(e){if(!e.cancelable)return;const t=Math.abs(e.touches[0].clientX-this.swipingStart.x);t>Math.abs(e.touches[0].clientY-this.swipingStart.y)&&t>5&&e.preventDefault()}performSwiping(e){this.isSwiping||(this.isSwiping=!0,this.setTransition(v),this.gestureCover=document.createElement("div"),this.gestureCover.classList.add("dxbl-gesture-cover"),this.appendChild(this.gestureCover),this.dispatchEvent(new c));this.applyTransform(this.getTransform(this.activeIndex,e.clientX-this.swipingStart.x))}getTransform(e,t=0){return`translateX(${-100*e+(0===t?0:Math.min(100,Math.max(-100,Math.round(t/this.width*100))))}%)`}applyTransform(e){this.content&&(this.content.style.transform=e)}setTransition(e){this.content&&(this.content.style.transition=e)}};e([a({attribute:"allow-mouse-wheel",type:Boolean})],b.prototype,"allowMouseWheel",void 0),e([a({attribute:"animation",type:String})],b.prototype,"animation",void 0),e([a({attribute:"active-index",type:Number})],b.prototype,"activeIndex",void 0),e([a({attribute:"display-index",type:Number})],b.prototype,"displayIndex",void 0),e([a({attribute:"loop",type:Boolean})],b.prototype,"loop",void 0),e([a({attribute:"swipe-mode",type:w,converter:s(w)})],b.prototype,"swipeMode",void 0),b=e([h("dxbl-carousel")],b);export{b as DxCarousel};
